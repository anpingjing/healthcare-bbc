# 企微健康社群管理后台系统 - 产品需求文档（PRD）

**文档版本**：V1.0  
**编制日期**：2026-02-04  
**编制人员**：产品团队  
**审核人员**：技术负责人、业务负责人  

---

## 目录

1. [文档概述](#1-文档概述)
2. [产品定位与目标](#2-产品定位与目标)
3. [功能需求](#3-功能需求)
4. [非功能需求](#4-非功能需求)
5. [用户界面与交互设计](#5-用户界面与交互设计)
6. [数据字典](#6-数据字典)
7. [业务流程](#7-业务流程)
8. [异常处理机制](#8-异常处理机制)
9. [系统集成要求](#9-系统集成要求)
10. [附录](#10-附录)

---

## 1. 文档概述

### 1.1 文档目的

本文档旨在详细描述企微健康社群管理后台系统的功能需求、非功能需求、业务流程及系统设计规范，为开发团队提供明确的产品开发指导，确保系统能够满足业务运营和管理需求。

### 1.2 文档范围

本文档涵盖管理后台系统的全部功能模块，包括：
- 用户角色与权限管理
- 企微社群生成与管理
- API信息管理
- 系统监控与运维
- 数据统计与分析

### 1.3 术语定义

| 术语 | 定义 |
|------|------|
| 4R角色 | 家庭医生、健康管家、权益顾问、保险顾问四种服务角色 |
| BBC模式 | Business to Business to Customer，企业对企业对客户的商业模式 |
| 企微 | 企业微信的简称 |
| RBAC | 基于角色的访问控制（Role-Based Access Control） |
| SaaS | 软件即服务（Software as a Service） |

### 1.4 参考文档

- 《企微健康社群方案 - 产品需求文档(PRD)》
- 《企微健康社群方案 - 开发文档》
- 《企业微信开发者文档》

---

## 2. 产品定位与目标

### 2.1 产品定位

企微健康社群管理后台系统是支撑"医生+AI+保险"三位一体健康管理服务模式的核心运营平台，为运营人员、管理人员、服务人员提供全方位的社群管理、用户服务、数据分析和系统配置能力。

### 2.2 产品目标

#### 2.2.1 业务目标

1. **提升运营效率**：通过自动化工具和智能调度，降低人工运营成本50%以上
2. **增强用户粘性**：实现社群活跃度提升30%，用户留存率提升25%
3. **促进业务转化**：保险转化率提升5%，健康服务使用率提升40%
4. **保障服务质量**：建立标准化服务流程，用户满意度达到4.5分以上

#### 2.2.2 技术目标

1. **高可用性**：系统可用性达到99.9%
2. **高性能**：页面响应时间≤2秒，接口响应时间≤1秒
3. **高并发**：支持10000+并发用户同时在线
4. **可扩展性**：支持水平扩展，满足业务快速增长需求

### 2.3 目标用户

| 用户角色 | 描述 | 核心需求 |
|---------|------|---------|
| 超级管理员 | 系统最高权限管理者 | 系统配置、权限管理、数据监控 |
| 运营管理员 | 负责社群运营和活动策划 | 社群管理、内容发布、活动配置 |
| 家庭医生 | 提供医疗咨询服务 | 患者管理、问诊处理、健康档案查看 |
| 健康管家 | AI协同服务人员 | 用户服务、任务处理、数据录入 |
| 权益顾问 | 健康权益服务提供者 | 权益管理、服务预约、活动组织 |
| 保险顾问 | 保险产品销售和服务 | 客户管理、保单管理、产品推荐 |
| 数据分析师 | 负责数据分析和报表 | 数据统计、报表生成、趋势分析 |
| 开发人员 | 系统维护和接口管理 | API管理、日志查看、系统监控 |

---

## 3. 功能需求

### 3.1 系统架构概览

```
┌─────────────────────────────────────────────────────────────────┐
│                      管理后台系统 (Admin Portal)                  │
├─────────────────────────────────────────────────────────────────┤
│  ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌────────┐ │
│  │ 用户权限  │ │ 社群管理  │ │ API管理  │ │ 数据统计  │ │系统设置│ │
│  │ 管理模块  │ │ 模块     │ │ 模块     │ │ 分析模块  │ │模块   │ │
│  └──────────┘ └──────────┘ └──────────┘ └──────────┘ └────────┘ │
├─────────────────────────────────────────────────────────────────┤
│                      服务层 (Service Layer)                      │
│  ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────┐            │
│  │ 用户服务  │ │ 社群服务  │ │ API网关  │ │ 权限服务  │            │
│  └──────────┘ └──────────┘ └──────────┘ └──────────┘            │
├─────────────────────────────────────────────────────────────────┤
│                      数据层 (Data Layer)                         │
│  ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────┐            │
│  │ MySQL    │ │ Redis    │ │ MongoDB  │ │ ES       │            │
│  └──────────┘ └──────────┘ └──────────┘ └──────────┘            │
└─────────────────────────────────────────────────────────────────┘
```

### 3.2 用户角色与权限管理模块

#### 3.2.1 功能概述

提供完整的RBAC（基于角色的访问控制）体系，支持多层级角色定义、细粒度权限控制和灵活的用户管理。

#### 3.2.2 功能清单

| 功能编号 | 功能名称 | 功能描述 | 优先级 |
|---------|---------|---------|--------|
| URM-001 | 角色定义管理 | 创建、编辑、删除系统角色 | P0 |
| URM-002 | 权限资源管理 | 管理系统功能权限和数据权限 | P0 |
| URM-003 | 角色权限配置 | 为角色分配功能权限和数据权限 | P0 |
| URM-004 | 用户账号管理 | 创建、编辑、禁用/启用用户账号 | P0 |
| URM-005 | 用户角色分配 | 为用户分配一个或多个角色 | P0 |
| URM-006 | 组织架构管理 | 管理部门和团队层级关系 | P1 |
| URM-007 | 登录认证管理 | 支持多种登录方式和认证策略 | P1 |
| URM-008 | 操作日志审计 | 记录用户操作行为，支持审计追溯 | P1 |
| URM-009 | 会话管理 | 管理用户在线会话，支持强制下线 | P2 |
| URM-010 | 密码策略管理 | 配置密码复杂度和过期策略 | P2 |

#### 3.2.3 详细功能说明

##### 3.2.3.1 角色定义管理 (URM-001)

**功能描述**：
支持创建自定义角色，定义角色的基本属性和职责范围。

**角色属性**：
- 角色编码：唯一标识，如`ROLE_DOCTOR`
- 角色名称：显示名称，如"家庭医生"
- 角色类型：系统预设/自定义
- 角色描述：职责说明
- 数据范围：全部数据/部门数据/个人数据
- 状态：启用/禁用
- 创建时间/更新时间

**预设角色**：

| 角色编码 | 角色名称 | 角色描述 | 数据范围 |
|---------|---------|---------|---------|
| ROLE_SUPER_ADMIN | 超级管理员 | 系统最高权限，可管理所有功能 | 全部数据 |
| ROLE_ADMIN | 运营管理员 | 负责社群运营和用户管理 | 全部数据 |
| ROLE_DOCTOR | 家庭医生 | 提供医疗咨询和健康管理服务 | 负责用户 |
| ROLE_HEALTH_MANAGER | 健康管家 | AI协同服务，处理日常咨询 | 负责用户 |
| ROLE_BENEFIT_ADVISOR | 权益顾问 | 管理健康权益和活动 | 全部权益 |
| ROLE_INSURANCE_ADVISOR | 保险顾问 | 提供保险咨询和销售服务 | 负责客户 |
| ROLE_ANALYST | 数据分析师 | 负责数据分析和报表 | 统计数据 |
| ROLE_DEVELOPER | 开发人员 | 系统维护和API管理 | 系统配置 |

**业务规则**：
1. 系统预设角色不可删除，可修改权限配置
2. 角色编码唯一，创建后不可修改
3. 角色被用户引用时不可删除
4. 支持角色继承，子角色自动继承父角色权限

**界面原型**：
- 角色列表页：展示角色基本信息，支持搜索、筛选、排序
- 角色详情页：展示角色完整信息和权限配置
- 角色编辑页：表单编辑角色属性

##### 3.2.3.2 权限资源管理 (URM-002)

**功能描述**：
管理系统功能权限和数据权限资源，支持权限的细粒度划分。

**权限类型**：

1. **功能权限（菜单权限）**：
   - 模块访问权限：如"社群管理"模块
   - 页面访问权限：如"社群列表"页面
   - 按钮操作权限：如"创建社群"按钮

2. **数据权限**：
   - 全部数据：可查看所有数据
   - 部门数据：可查看本部门及子部门数据
   - 个人数据：仅可查看自己创建/负责的数据
   - 自定义数据：按特定规则筛选的数据

3. **API权限**：
   - 接口访问权限
   - 接口调用频率限制

**权限编码规范**：
```
格式：[模块]:[资源]:[操作]
示例：
- community:group:create  （社群创建权限）
- community:group:update  （社群编辑权限）
- community:group:delete  （社群删除权限）
- community:group:view    （社群查看权限）
- user:info:view:all      （查看全部用户权限）
- user:info:view:dept     （查看部门用户权限）
- user:info:view:self     （查看个人用户权限）
```

**权限树结构**：
```
系统管理
├── 用户管理
│   ├── 用户查看
│   ├── 用户创建
│   ├── 用户编辑
│   └── 用户删除
├── 角色管理
│   ├── 角色查看
│   ├── 角色创建
│   ├── 角色编辑
│   └── 角色删除
└── 权限管理
    ├── 权限查看
    └── 权限配置

社群管理
├── 社群列表
│   ├── 查看社群
│   ├── 创建社群
│   ├── 编辑社群
│   └── 解散社群
├── 成员管理
│   ├── 查看成员
│   ├── 添加成员
│   └── 移除成员
└── 内容管理
    ├── 查看内容
    ├── 发布内容
    └── 删除内容
```

##### 3.2.3.3 用户账号管理 (URM-004)

**功能描述**：
管理系统用户账号，支持账号的增删改查和状态管理。

**用户属性**：
- 基本信息：用户名、真实姓名、手机号、邮箱
- 账号信息：账号状态、登录密码、最后登录时间
- 角色信息：关联角色列表
- 部门信息：所属部门
- 企微信息：绑定的企业微信账号
- 扩展信息：头像、签名、备注

**账号状态**：
- 正常：可正常登录和使用
- 禁用：不可登录，保留数据
- 锁定：因安全原因临时锁定
- 过期：账号有效期已过

**业务规则**：
1. 用户名全局唯一，不可重复
2. 手机号需验证唯一性
3. 禁用账号自动踢出所有在线会话
4. 支持批量导入用户
5. 支持账号与企微账号绑定/解绑

**用户导入模板**：
```csv
用户名,真实姓名,手机号,邮箱,角色编码,部门编码
zhangsan,张三,13800138000,zhangsan@example.com,ROLE_DOCTOR,DEPT_001
lisi,李四,13900139000,lisi@example.com,ROLE_HEALTH_MANAGER,DEPT_002
```

##### 3.2.3.4 登录认证管理 (URM-007)

**功能描述**：
提供多种登录认证方式，保障系统访问安全。

**登录方式**：
1. **账号密码登录**：基础登录方式
2. **企业微信扫码登录**：扫码授权登录
3. **手机号验证码登录**：短信验证码登录
4. **双因素认证**：密码+动态令牌

**安全策略**：
- 登录失败锁定：连续5次失败锁定30分钟
- 密码复杂度：至少8位，包含大小写字母、数字、特殊字符
- 密码过期：90天强制修改密码
- 会话超时：30分钟无操作自动退出
- 异地登录提醒：检测到异常登录位置发送提醒

#### 3.2.4 界面设计

##### 3.2.4.1 角色管理页面

**页面布局**：
```
┌─────────────────────────────────────────────────────────────┐
│ 角色管理                                          [创建角色] │
├─────────────────────────────────────────────────────────────┤
│ 搜索: [____________]  状态: [全部▼]  类型: [全部▼] [查询]    │
├─────────────────────────────────────────────────────────────┤
│ ┌─────────┬──────────┬────────┬──────────┬────────┬──────┐ │
│ │ 角色编码 │ 角色名称  │ 角色类型│ 数据范围  │ 状态   │ 操作 │ │
│ ├─────────┼──────────┼────────┼──────────┼────────┼──────┤ │
│ │ ROLE_001│ 家庭医生  │ 系统   │ 负责用户  │ 启用   │编辑│ │
│ │ ROLE_002│ 健康管家  │ 系统   │ 负责用户  │ 启用   │编辑│ │
│ │ ROLE_003│ 运营管理员│ 自定义 │ 全部数据  │ 启用   │编辑│ │
│ └─────────┴──────────┴────────┴──────────┴────────┴──────┘ │
│                      分页: [1][2][3]...                     │
└─────────────────────────────────────────────────────────────┘
```

##### 3.2.4.2 权限配置页面

**页面布局**：
```
┌─────────────────────────────────────────────────────────────┐
│ 权限配置 - 家庭医生                                          │
├─────────────────────────────────────────────────────────────┤
│ 基本信息                                                    │
│ 角色名称: [家庭医生                    ]                    │
│ 角色描述: [提供医疗咨询和健康管理服务  ]                    │
│ 数据范围: [负责用户                    ]                    │
├─────────────────────────────────────────────────────────────┤
│ 功能权限                                                    │
│ [√] 系统管理                                                │
│   [√] 个人中心                                              │
│   [ ] 用户管理                                              │
│ [√] 社群管理                                                │
│   [√] 社群查看    [√] 成员查看                              │
│ [√] 健康管理                                                │
│   [√] 健康档案    [√] 问诊处理    [√] 健康计划              │
│ [ ] 保险管理                                                │
│ [√] 权益管理                                                │
│   [√] 权益查看    [ ] 权益配置                              │
├─────────────────────────────────────────────────────────────┤
│                    [取消]              [保存]               │
└─────────────────────────────────────────────────────────────┘
```

### 3.3 企微社群管理模块

#### 3.3.1 功能概述

提供企业微信社群的全生命周期管理，包括社群创建、配置、成员管理、内容管理、数据分析等功能，支持4R角色协同服务。

#### 3.3.2 功能清单

| 功能编号 | 功能名称 | 功能描述 | 优先级 |
|---------|---------|---------|--------|
| GCM-001 | 社群列表管理 | 查看和管理所有社群 | P0 |
| GCM-002 | 社群创建 | 创建新的企微社群 | P0 |
| GCM-003 | 社群配置 | 配置社群基本信息和规则 | P0 |
| GCM-004 | 社群解散 | 解散不再使用的社群 | P0 |
| GCM-005 | 成员管理 | 管理社群成员，包括添加、移除、禁言 | P0 |
| GCM-006 | 角色分配 | 为社群分配4R服务角色 | P0 |
| GCM-007 | 内容管理 | 管理社群内的消息和内容 | P1 |
| GCM-008 | 欢迎语配置 | 配置入群欢迎语和自动回复 | P1 |
| GCM-009 | 关键词回复 | 配置关键词自动回复规则 | P1 |
| GCM-010 | 群发消息 | 向多个社群群发消息 | P1 |
| GCM-011 | 社群数据分析 | 统计社群活跃度、成员增长等数据 | P2 |
| GCM-012 | 社群标签 | 为社群打标签，便于分类管理 | P2 |

#### 3.3.3 详细功能说明

##### 3.3.3.1 社群创建 (GCM-002)

**功能描述**：
创建新的企业微信社群，配置社群基本信息和服务角色。

**创建流程**：
1. 填写社群基本信息
2. 选择社群类型和标签
3. 配置4R服务角色
4. 设置入群规则和欢迎语
5. 创建企微群并获取群ID
6. 生成入群二维码/链接

**社群属性**：
- 基本信息：
  - 社群名称（必填）
  - 社群类型：健康交流群/慢病管理群/保险服务群/综合群
  - 社群标签：可多选，如"高血压"、"糖尿病"、"老年人群"
  - 社群简介
  - 社群头像
  - 最大成员数：默认500
  
- 服务配置：
  - 家庭医生：选择负责医生
  - 健康管家：选择AI或人工管家
  - 权益顾问：选择权益服务人员
  - 保险顾问：选择保险服务人员
  
- 入群配置：
  - 入群审核：需要审核/自动通过
  - 入群欢迎语：文本/图文/小程序卡片
  - 自动推送表单：健康信息采集表单
  
- 规则配置：
  - 发言规则：是否禁言/定时禁言
  - 广告过滤：开启/关闭
  - 敏感词过滤：关键词列表

**业务规则**：
1. 社群名称在企业微信内唯一
2. 至少配置一个4R角色
3. 创建成功后自动生成入群链接
4. 支持创建时从模板导入配置

##### 3.3.3.2 成员管理 (GCM-005)

**功能描述**：
管理社群成员，查看成员信息，执行成员操作。

**成员信息**：
- 基本信息：昵称、头像、入群时间
- 企业微信信息：外部联系人ID、客户标签
- 健康档案：健康状态、慢病标签
- 保单信息：持有保单、保障缺口
- 服务记录：咨询记录、服务评价
- 活跃度数据：发言次数、最后活跃时间

**成员操作**：
- 查看详情：查看成员完整信息
- 发送消息：单独发送消息给成员
- 移出群聊：将成员移出社群
- 设置禁言：禁言时长设置
- 设为管理员：设置成员为群管理员
- 标签管理：为成员打标签

**批量操作**：
- 批量导入成员
- 批量移出群聊
- 批量发送消息
- 批量标签设置

**成员筛选**：
- 按入群时间筛选
- 按活跃度筛选
- 按健康标签筛选
- 按保单状态筛选
- 按服务状态筛选

##### 3.3.3.3 内容管理 (GCM-007)

**功能描述**：
管理社群内的消息内容，包括查看、审核、删除等操作。

**内容类型**：
- 文本消息
- 图片消息
- 语音消息
- 视频消息
- 文件消息
- 链接消息
- 小程序卡片
- 图文卡片

**内容管理功能**：
- 消息列表：按时间倒序展示所有消息
- 消息搜索：按关键词、发送者、时间搜索
- 消息审核：敏感消息人工审核
- 消息删除：删除违规消息
- 消息置顶：置顶重要消息
- 消息收藏：收藏优质内容

**内容审核**：
- 自动审核：敏感词过滤、广告识别
- 人工审核：标记可疑消息人工复核
- 审核结果：通过/拒绝/需修改

**内容统计**：
- 消息总量统计
- 消息类型分布
- 活跃用户排行
- 热门话题分析

##### 3.3.3.4 关键词回复 (GCM-009)

**功能描述**：
配置关键词自动回复规则，实现智能客服功能。

**规则配置**：
- 关键词：支持精确匹配、模糊匹配、正则匹配
- 匹配模式：全词匹配/包含匹配/开头匹配/结尾匹配
- 回复内容：文本/图文/链接/小程序
- 生效时间：全天/指定时间段
- 触发限制：每人每天触发次数
- 优先级：规则匹配优先级

**预设关键词**：

| 关键词 | 匹配模式 | 回复内容 | 优先级 |
|--------|---------|---------|--------|
| 血压 | 包含匹配 | 血压管理指南链接 | 高 |
| 血糖 | 包含匹配 | 血糖监测教程 | 高 |
| 保险 | 包含匹配 | 保险产品介绍 | 中 |
| 体检 | 包含匹配 | 体检预约入口 | 中 |
| 医生 | 包含匹配 | 医生排班信息 | 高 |
| 投诉 | 包含匹配 | 投诉处理流程 | 最高 |

**业务规则**：
1. 关键词不区分大小写
2. 多条规则匹配时按优先级排序
3. 支持变量替换，如{username}替换为用户名
4. 支持条件判断，如根据用户标签回复不同内容

#### 3.3.4 界面设计

##### 3.3.4.1 社群列表页面

**页面布局**：
```
┌─────────────────────────────────────────────────────────────┐
│ 社群管理                                          [创建社群] │
├─────────────────────────────────────────────────────────────┤
│ 搜索: [____________] 类型: [全部▼] 标签: [全部▼] 状态: [全部▼]│
├─────────────────────────────────────────────────────────────┤
│ ┌─────────┬────────┬────────┬──────┬──────┬──────┬──────┐  │
│ │ 社群名称 │ 类型   │ 成员数 │ 医生 │ 管家 │ 状态 │ 操作 │  │
│ ├─────────┼────────┼────────┼──────┼──────┼──────┼──────┤  │
│ │ 高血压群 │ 慢病群 │ 128人  │ 张医生│ AI  │ 正常 │管理│  │
│ │ 保险服务群│ 保险群 │ 256人  │ -    │ 小王 │ 正常 │管理│  │
│ │ 健康交流群│ 综合群 │ 89人   │ 李医生│ AI  │ 正常 │管理│  │
│ └─────────┴────────┴────────┴──────┴──────┴──────┴──────┘  │
└─────────────────────────────────────────────────────────────┘
```

##### 3.3.4.2 社群详情页面

**页面布局**：
```
┌─────────────────────────────────────────────────────────────┐
│ 高血压管理群                                    [编辑][解散]│
├─────────────────────────────────────────────────────────────┤
│ 标签: #高血压 #中老年 #慢病管理    成员: 128人   创建: 2026-01│
├─────────────────────────────────────────────────────────────┤
│ Tab: [概览] [成员管理] [内容管理] [数据分析] [设置]         │
├─────────────────────────────────────────────────────────────┤
│ 4R服务角色                                                   │
│ ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────┐        │
│ │  张医生   │ │   AI     │ │   小李   │ │   小王   │        │
│ │ 家庭医生  │ │ 健康管家  │ │ 权益顾问  │ │ 保险顾问  │        │
│ └──────────┘ └──────────┘ └──────────┘ └──────────┘        │
├─────────────────────────────────────────────────────────────┤
│ 活跃度趋势                                                   │
│ [折线图展示近30天活跃度]                                     │
├─────────────────────────────────────────────────────────────┤
│ 快捷操作                                                     │
│ [发送消息] [群发通知] [导出成员] [查看日志]                  │
└─────────────────────────────────────────────────────────────┘
```

### 3.4 API信息管理模块

#### 3.4.1 功能概述

提供API接口的全生命周期管理，包括API录入、编辑、查询、测试、文档生成等功能，支持企业微信API和自定义业务API的管理。

#### 3.4.2 功能清单

| 功能编号 | 功能名称 | 功能描述 | 优先级 |
|---------|---------|---------|--------|
| API-001 | API列表 | 查看所有API接口信息 | P0 |
| API-002 | API录入 | 录入新的API接口信息 | P0 |
| API-003 | API编辑 | 编辑已有API接口信息 | P0 |
| API-004 | API查询 | 搜索和筛选API接口 | P0 |
| API-005 | API测试 | 在线测试API接口 | P0 |
| API-006 | API文档 | 生成和查看API文档 | P1 |
| API-007 | API版本管理 | 管理API接口版本 | P1 |
| API-008 | API权限管理 | 配置API访问权限 | P1 |
| API-009 | API调用统计 | 统计API调用情况 | P2 |
| API-010 | API告警配置 | 配置API异常告警 | P2 |

#### 3.4.3 详细功能说明

##### 3.4.3.1 API录入 (API-002)

**功能描述**：
录入新的API接口信息，支持手动录入和自动导入。

**API信息字段**：

**基本信息**：
- API名称：接口显示名称
- API编码：唯一标识符
- API分类：企业微信API/业务API/第三方API
- API版本：v1/v2等
- 请求方法：GET/POST/PUT/DELETE/PATCH
- 请求路径：接口URL路径
- 接口描述：功能说明
- 接口状态：开发中/已发布/已废弃

**请求信息**：
- Content-Type：application/json等
- 请求头参数：Header参数列表
- 请求参数：Query/Body参数列表
  - 参数名
  - 参数类型：String/Number/Boolean/Object/Array
  - 是否必填
  - 默认值
  - 参数描述
  - 示例值

**响应信息**：
- 响应格式：JSON/XML
- 成功响应示例
- 错误响应示例
- 响应字段说明

**企业微信API特殊字段**：
- 接口类型：通讯录/客户联系/应用管理/消息推送等
- 权限要求：需要的接口权限
- 调用频率限制：次/秒
- 官方文档链接

**业务规则**：
1. API编码全局唯一，格式：`[分类]:[模块]:[功能]`
2. 企业微信API自动从官方文档导入
3. 支持API分组管理
4. 支持API依赖关系配置

##### 3.4.3.2 API测试 (API-005)

**功能描述**：
提供在线API测试功能，支持参数配置、请求发送、响应查看。

**测试功能**：
- 参数填写：自动渲染参数输入表单
- 环境选择：开发/测试/生产环境
- 请求发送：执行API调用
- 响应展示：格式化展示响应结果
- 响应验证：验证响应是否符合预期
- 测试历史：保存测试记录

**测试环境配置**：
```json
{
  "development": {
    "baseUrl": "http://localhost:8080",
    "headers": {
      "Authorization": "Bearer {token}"
    }
  },
  "testing": {
    "baseUrl": "https://api-test.example.com",
    "headers": {
      "Authorization": "Bearer {token}"
    }
  },
  "production": {
    "baseUrl": "https://api.example.com",
    "headers": {
      "Authorization": "Bearer {token}"
    }
  }
}
```

**测试断言**：
- 状态码断言：验证HTTP状态码
- 响应时间断言：验证响应时间
- 响应体断言：验证响应内容
- 字段存在断言：验证字段是否存在
- 字段类型断言：验证字段类型

##### 3.4.3.3 API文档生成 (API-006)

**功能描述**：
自动生成API接口文档，支持多种格式导出。

**文档内容**：
- 接口概述：接口功能说明
- 请求信息：请求方法、路径、参数
- 响应信息：响应格式、字段说明
- 错误码：错误码列表及说明
- 示例代码：多种语言调用示例
- 更新日志：接口变更历史

**文档格式**：
- Markdown格式
- HTML格式
- PDF格式
- OpenAPI/Swagger格式
- Postman Collection格式

**企业微信API文档模板**：
```markdown
# 获取客户列表

## 接口说明
获取企业微信客户列表

## 请求方式
GET

## 请求地址
https://qyapi.weixin.qq.com/cgi-bin/externalcontact/list

## 权限要求
需要客户联系权限

## 请求参数

| 参数名 | 必填 | 类型 | 说明 |
|--------|------|------|------|
| access_token | 是 | String | 调用接口凭证 |
| userid | 否 | String | 企业成员ID |

## 响应示例

```json
{
  "errcode": 0,
  "errmsg": "ok",
  "external_userid": ["woxxxx", "woyyyy"]
}
```

## 错误码

| 错误码 | 说明 |
|--------|------|
| 0 | 成功 |
| 40014 | access_token无效 |
| 60011 | 没有权限 |
```

#### 3.4.4 界面设计

##### 3.4.4.1 API列表页面

**页面布局**：
```
┌─────────────────────────────────────────────────────────────┐
│ API管理                                           [录入API] │
├─────────────────────────────────────────────────────────────┤
│ 搜索: [____________] 分类: [全部▼] 方法: [全部▼] 状态: [全部▼]│
├─────────────────────────────────────────────────────────────┤
│ ┌──────────┬────────┬────────┬────────┬──────────┬──────┐  │
│ │ API名称   │ 方法   │ 路径   │ 分类   │ 状态    │ 操作 │  │
│ ├──────────┼────────┼────────┼────────┼──────────┼──────┤  │
│ │ 获取客户列表│ GET   │ /ext...│ 企微   │ 已发布  │测试│  │
│ │ 发送消息  │ POST   │ /msg...│ 企微   │ 已发布  │测试│  │
│ │ 创建社群  │ POST   │ /grou..│ 业务   │ 开发中  │测试│  │
│ └──────────┴────────┴────────┴────────┴──────────┴──────┘  │
└─────────────────────────────────────────────────────────────┘
```

##### 3.4.4.2 API测试页面

**页面布局**：
```
┌─────────────────────────────────────────────────────────────┐
│ API测试 - 获取客户列表                                       │
├─────────────────────────────────────────────────────────────┤
│ 环境: [开发环境▼]                                           │
├─────────────────────────────────────────────────────────────┤
│ 请求信息                                                     │
│ 方法: GET                                                   │
│ 路径: /api/v1/wechat/externalcontact/list                   │
│                                                             │
│ 请求参数                                                     │
│ ┌──────────────┬──────────┬────────┬──────────────────────┐ │
│ │ 参数名       │ 类型     │ 必填   │ 值                   │ │
│ ├──────────────┼──────────┼────────┼──────────────────────┤ │
│ │ access_token │ String   │ 是     │ [__________________] │ │
│ │ userid       │ String   │ 否     │ [__________________] │ │
│ └──────────────┴──────────┴────────┴──────────────────────┘ │
│                                                             │
│ [发送请求]                                                  │
├─────────────────────────────────────────────────────────────┤
│ 响应结果                                                     │
│ Status: 200 OK (120ms)                                      │
│ ```json                                                     │
│ {                                                           │
│   "errcode": 0,                                            │
│   "errmsg": "ok",                                          │
│   "external_userid": ["woxxxx"]                            │
│ }                                                           │
│ ```                                                         │
└─────────────────────────────────────────────────────────────┘
```

### 3.5 数据统计与分析模块

#### 3.5.1 功能概述

提供全面的数据统计和分析功能，帮助运营人员了解业务状况，支持数据驱动决策。

#### 3.5.2 功能清单

| 功能编号 | 功能名称 | 功能描述 | 优先级 |
|---------|---------|---------|--------|
| STA-001 | 用户数据统计 | 统计用户增长、活跃、留存等数据 | P1 |
| STA-002 | 社群数据统计 | 统计社群活跃度、成员增长等数据 | P1 |
| STA-003 | 服务数据统计 | 统计服务咨询量、满意度等数据 | P1 |
| STA-004 | 保险数据统计 | 统计保单、保费、转化率等数据 | P1 |
| STA-005 | 权益数据统计 | 统计权益领取、使用情况等数据 | P2 |
| STA-006 | 数据报表 | 生成和导出数据报表 | P2 |
| STA-007 | 数据大屏 | 可视化展示核心业务指标 | P2 |
| STA-008 | 自定义报表 | 支持自定义报表配置 | P3 |

#### 3.5.3 核心指标定义

**用户指标**：
- 新增用户数：统计周期内新注册用户数
- 活跃用户数：统计周期内有操作的用户数
- 留存率：次日/7日/30日留存率
- 用户画像分布：年龄、性别、地域分布

**社群指标**：
- 社群总数：当前社群总数
- 新增社群数：统计周期内新增社群数
- 社群活跃度：日均消息数/成员发言率
- 成员增长率：(本期成员数-上期成员数)/上期成员数

**服务指标**：
- 咨询总量：统计周期内咨询总数
- 平均响应时间：首次响应平均时长
- 服务满意度：用户评价平均分
- 问题解决率：已解决咨询/总咨询数

**业务指标**：
- 保单转化率：投保用户数/咨询用户数
- 保费收入：统计周期内保费总额
- 权益使用率：已使用权益/总权益数
- 健康计划完成率：已完成计划/总计划数

### 3.6 系统设置模块

#### 3.6.1 功能概述

提供系统级配置管理，包括基础设置、企业微信配置、通知配置、日志管理等。

#### 3.6.2 功能清单

| 功能编号 | 功能名称 | 功能描述 | 优先级 |
|---------|---------|---------|--------|
| SET-001 | 基础设置 | 系统名称、Logo、版权信息等 | P1 |
| SET-002 | 企微配置 | 企业微信API配置 | P0 |
| SET-003 | 通知配置 | 短信、邮件、企微通知配置 | P1 |
| SET-004 | 安全设置 | 登录安全、密码策略配置 | P1 |
| SET-005 | 日志管理 | 系统日志查看和导出 | P2 |
| SET-006 | 数据备份 | 数据库备份配置 | P2 |
| SET-007 | 缓存管理 | Redis缓存查看和清理 | P3 |

---

## 4. 非功能需求

### 4.1 性能需求

#### 4.1.1 响应时间

| 场景 | 要求 | 说明 |
|------|------|------|
| 页面加载 | ≤2秒 | 首屏加载完成时间 |
| 接口响应 | ≤1秒 | 95%的接口响应时间 |
| 复杂查询 | ≤3秒 | 大数据量统计查询 |
| 报表生成 | ≤10秒 | 大数据量报表导出 |

#### 4.1.2 并发能力

- 系统支持10000+并发用户同时在线
- 支持1000+并发请求处理
- 消息推送支持10000条/秒

#### 4.1.3 数据处理能力

- 支持100万+用户数据存储
- 支持1000万+消息记录存储
- 支持日增量10万+数据处理

### 4.2 安全需求

#### 4.2.1 数据安全

- **传输加密**：全站HTTPS，TLS 1.3
- **存储加密**：敏感数据AES-256加密存储
- **密码安全**：BCrypt算法加密，加盐处理
- **数据脱敏**：手机号、身份证号等敏感信息脱敏显示

#### 4.2.2 访问安全

- **身份认证**：JWT Token认证，支持双因素认证
- **权限控制**：RBAC细粒度权限控制
- **会话管理**：30分钟无操作自动退出，支持强制下线
- **登录安全**：失败锁定、异地登录提醒

#### 4.2.3 应用安全

- **SQL注入防护**：参数化查询，ORM框架
- **XSS防护**：输入过滤，输出编码
- **CSRF防护**：Token验证
- **接口安全**：签名验证，频率限制

### 4.3 可用性需求

- **系统可用性**：≥99.9%（年度停机时间<8.76小时）
- **故障恢复**：RTO≤30分钟，RPO≤5分钟
- **容错能力**：单点故障不影响整体服务
- **降级策略**：核心功能降级保障

### 4.4 可扩展性需求

- **水平扩展**：支持服务集群部署
- **数据库扩展**：支持读写分离、分库分表
- **缓存扩展**：支持Redis集群
- **功能扩展**：插件化架构，支持功能模块热插拔

### 4.5 兼容性需求

- **浏览器兼容**：Chrome 90+、Firefox 88+、Safari 14+、Edge 90+
- **移动端兼容**：iOS 13+、Android 8+
- **分辨率适配**：支持1366×768及以上分辨率
- **企业微信版本**：支持企微3.0及以上版本

### 4.6 可维护性需求

- **代码规范**：遵循阿里巴巴Java开发手册
- **文档完整**：接口文档、数据库文档、部署文档
- **日志规范**：统一日志格式，支持日志级别配置
- **监控告警**：核心指标监控，异常自动告警

---

## 5. 用户界面与交互设计

### 5.1 设计原则

1. **简洁高效**：界面简洁，操作高效，减少用户学习成本
2. **一致性**：保持视觉和交互的一致性
3. **反馈及时**：操作后及时给予反馈
4. **容错性**：支持操作撤销，防止误操作
5. **可访问性**：考虑色盲、视障用户的使用

### 5.2 视觉规范

#### 5.2.1 色彩系统

**主色调**：
- 品牌色：#1890FF（蓝色）
- 成功色：#52C41A（绿色）
- 警告色：#FAAD14（橙色）
- 错误色：#F5222D（红色）
- 信息色：#1890FF（蓝色）

**中性色**：
- 标题文字：#262626
- 正文文字：#595959
n- 辅助文字：#8C8C8C
- 禁用文字：#BFBFBF
- 边框颜色：#D9D9D9
- 分割线：#E8E8E8
- 背景色：#F5F5F5

#### 5.2.2 字体规范

- **字体家族**：-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial
- **标题字号**：
  - 一级标题：24px，字重600
  - 二级标题：20px，字重600
  - 三级标题：16px，字重600
- **正文字号**：14px，字重400
- **辅助文字**：12px，字重400

#### 5.2.3 布局规范

- **页面宽度**：自适应，最大1920px
- **侧边栏宽度**：200px（可折叠）
- **顶部导航高度**：64px
- **内容区域边距**：24px
- **卡片间距**：16px
- **表单标签宽度**：120px

### 5.3 交互规范

#### 5.3.1 页面加载

- 显示加载动画
- 骨架屏预加载
- 渐进式内容展示

#### 5.3.2 表单操作

- 实时校验：输入时即时校验
- 提交校验：提交时完整校验
- 错误提示：明确提示错误原因和修复建议
- 自动保存：长表单支持自动保存草稿

#### 5.3.3 列表操作

- 分页：每页默认20条
- 排序：支持多字段排序
- 筛选：支持多条件组合筛选
- 批量操作：支持批量选择和操作

#### 5.3.4 弹窗规范

- 确认弹窗：危险操作二次确认
- 表单弹窗：新增/编辑使用弹窗
- 详情弹窗：复杂详情使用抽屉
- 弹窗尺寸：小(400px)、中(600px)、大(800px)

### 5.4 响应式设计

#### 5.4.1 断点定义

| 断点 | 宽度范围 | 设备类型 |
|------|---------|---------|
| xs | <576px | 手机 |
| sm | 576px-768px | 平板竖屏 |
| md | 768px-992px | 平板横屏 |
| lg | 992px-1200px | 笔记本 |
| xl | 1200px-1600px | 桌面显示器 |
| xxl | >1600px | 大屏显示器 |

#### 5.4.2 适配策略

- **侧边栏**：lg以下自动折叠
- **表格**：xs下卡片式展示
- **图表**：自适应容器大小
- **字体**：xs下缩小一级

---

## 6. 数据字典

### 6.1 用户相关

#### 6.1.1 用户状态 (user_status)

| 编码 | 名称 | 说明 |
|------|------|------|
| 1 | 正常 | 账号正常使用 |
| 2 | 禁用 | 账号被禁用，不可登录 |
| 3 | 锁定 | 账号被临时锁定 |
| 4 | 过期 | 账号有效期已过 |

#### 6.1.2 性别 (gender)

| 编码 | 名称 |
|------|------|
| 0 | 未知 |
| 1 | 男 |
| 2 | 女 |

### 6.2 社群相关

#### 6.2.1 社群类型 (group_type)

| 编码 | 名称 | 说明 |
|------|------|------|
| 1 | 健康交流群 | 一般健康话题交流 |
| 2 | 慢病管理群 | 慢性病管理专用群 |
| 3 | 保险服务群 | 保险咨询和服务群 |
| 4 | 综合群 | 综合服务群 |

#### 6.2.2 社群状态 (group_status)

| 编码 | 名称 | 说明 |
|------|------|------|
| 1 | 正常 | 社群正常运行 |
| 2 | 禁言 | 全员禁言状态 |
| 3 | 解散 | 社群已解散 |

### 6.3 API相关

#### 6.3.1 API分类 (api_category)

| 编码 | 名称 |
|------|------|
| 1 | 企业微信API |
| 2 | 业务API |
| 3 | 第三方API |

#### 6.3.2 API状态 (api_status)

| 编码 | 名称 |
|------|------|
| 1 | 开发中 |
| 2 | 测试中 |
| 3 | 已发布 |
| 4 | 已废弃 |

#### 6.3.3 HTTP方法 (http_method)

| 编码 | 名称 |
|------|------|
| GET | GET |
| POST | POST |
| PUT | PUT |
| DELETE | DELETE |
| PATCH | PATCH |

### 6.4 权限相关

#### 6.4.1 数据范围 (data_scope)

| 编码 | 名称 | 说明 |
|------|------|------|
| 1 | 全部数据 | 可查看所有数据 |
| 2 | 部门数据 | 可查看本部门及子部门数据 |
| 3 | 个人数据 | 仅可查看自己负责的数据 |
| 4 | 自定义 | 按自定义规则筛选 |

---

## 7. 业务流程

### 7.1 用户管理流程

```
┌──────────┐    ┌──────────┐    ┌──────────┐    ┌──────────┐
│ 创建用户  │ -> │ 分配角色  │ -> │ 配置权限  │ -> │ 账号激活  │
└──────────┘    └──────────┘    └──────────┘    └──────────┘
      │                                              │
      v                                              v
┌──────────┐                                ┌──────────┐
│ 发送通知  │                                │ 正常使用  │
└──────────┘                                └──────────┘
                                                   │
      ┌─────────────────────────────────────────────┘
      v
┌──────────┐    ┌──────────┐    ┌──────────┐
│ 禁用/启用 │ <- │ 编辑信息  │ <- │ 重置密码  │
└──────────┘    └──────────┘    └──────────┘
```

### 7.2 社群创建流程

```
┌──────────┐    ┌──────────┐    ┌──────────┐    ┌──────────┐
│ 填写信息  │ -> │ 选择角色  │ -> │ 配置规则  │ -> │ 创建企微群│
└──────────┘    └──────────┘    └──────────┘    └──────────┘
      │                                              │
      v                                              v
┌──────────┐                                ┌──────────┐
│ 保存草稿  │                                │ 生成二维码│
└──────────┘                                └──────────┘
                                                   │
      ┌─────────────────────────────────────────────┘
      v
┌──────────┐    ┌──────────┐
│ 推广入群  │ -> │ 运营管理  │
└──────────┘    └──────────┘
```

### 7.3 API管理流程

```
┌──────────┐    ┌──────────┐    ┌──────────┐    ┌──────────┐
│ 录入API   │ -> │ 配置参数  │ -> │ 接口测试  │ -> │ 发布上线  │
└──────────┘    └──────────┘    └──────────┘    └──────────┘
      │              │              │              │
      v              v              v              v
┌──────────┐    ┌──────────┐    ┌──────────┐    ┌──────────┐
│ 自动生成  │    │ 生成文档  │    │ 生成用例  │    │ 版本管理  │
│ 文档草稿  │    │          │    │          │    │          │
└──────────┘    └──────────┘    └──────────┘    └──────────┘
```

### 7.4 权限分配流程

```
┌──────────┐    ┌──────────┐    ┌──────────┐    ┌──────────┐
│ 创建角色  │ -> │ 配置功能  │ -> │ 配置数据  │ -> │ 分配用户  │
└──────────┘    └──────────┘    └──────────┘    └──────────┘
      │                                              │
      v                                              v
┌──────────┐                                ┌──────────┐
│ 继承父角色│                                │ 权限生效  │
└──────────┘                                └──────────┘
```

---

## 8. 异常处理机制

### 8.1 异常分类

| 异常类型 | 说明 | 处理方式 |
|---------|------|---------|
| 业务异常 | 业务规则校验失败 | 返回明确错误信息 |
| 系统异常 | 程序运行错误 | 记录日志，返回通用错误 |
| 网络异常 | 网络连接失败 | 自动重试，降级处理 |
| 数据异常 | 数据库操作失败 | 事务回滚，记录日志 |
| 安全异常 | 权限验证失败 | 记录审计日志，拒绝访问 |

### 8.2 错误码规范

**错误码格式**：`[模块][类型][序号]`

| 模块 | 编码 |
|------|------|
| 通用 | 00 |
| 用户 | 01 |
| 社群 | 02 |
| API | 03 |
| 权限 | 04 |

| 类型 | 编码 |
|------|------|
| 参数错误 | 01 |
| 业务错误 | 02 |
| 系统错误 | 03 |
| 权限错误 | 04 |

**错误码示例**：

| 错误码 | 错误信息 | 说明 |
|--------|---------|------|
| 0001001 | 参数不能为空 | 通用参数校验错误 |
| 0101001 | 用户名已存在 | 用户创建错误 |
| 0102001 | 用户不存在 | 用户查询错误 |
| 0201001 | 社群名称不能为空 | 社群创建参数错误 |
| 0202001 | 社群不存在 | 社群查询错误 |
| 0301001 | API路径不能为空 | API录入参数错误 |
| 0404001 | 无权访问该资源 | 权限不足 |

### 8.3 异常处理流程

```
┌──────────┐    ┌──────────┐    ┌──────────┐    ┌──────────┐
│ 异常发生  │ -> │ 异常捕获  │ -> │ 日志记录  │ -> │ 异常处理  │
└──────────┘    └──────────┘    └──────────┘    └──────────┘
      │                                              │
      v                                              v
┌──────────┐                                ┌──────────┐
│ 发送告警  │                                │ 返回响应  │
└──────────┘                                └──────────┘
```

### 8.4 降级策略

| 场景 | 降级策略 |
|------|---------|
| 数据库故障 | 使用缓存数据，只读模式 |
| Redis故障 | 直连数据库，降低并发 |
| 企微API故障 | 使用本地队列，延迟处理 |
| 消息推送失败 | 记录失败日志，定时重试 |

---

## 9. 系统集成要求

### 9.1 企业微信集成

#### 9.1.1 集成范围

- **通讯录同步**：同步企业组织架构和成员
- **客户联系**：获取客户列表，发送消息
- **应用管理**：管理企业微信应用
- **消息推送**：发送应用消息和群消息
- **JS-SDK**：前端调用企微原生能力

#### 9.1.2 集成方式

- **API调用**：RESTful API方式调用企微接口
- **消息回调**：接收企微推送的消息和事件
- **前端集成**：使用企微JS-SDK

#### 9.1.3 集成配置

```yaml
wechat:
  work:
    corp-id: wwace533e386c63f72
    corp-secret: x-3ikL_1L8FpaqgMTGYmVWwcFACTwmV8gW-h7hLqIoM
    agent-id: 1000007
    token: IlXP1Nd8pFlHfcl
    encoding-aes-key: Tr2NfsFeAjsyKMP5e5u7HqoyNMYWeP4wyXTO5G4t0Ir
    callback-url: https://your-domain/api/v1/wechat/callback
```

### 9.2 AI服务集成

#### 9.2.1 集成范围

- **意图识别**：识别用户咨询意图
- **智能回复**：生成智能回复内容
- **健康评估**：评估用户健康状况
- **风险预测**：预测疾病风险

#### 9.2.2 集成方式

- **API调用**：调用AI服务提供的RESTful API
- **消息队列**：使用RabbitMQ异步处理
- **流式响应**：支持SSE流式返回

### 9.3 外部系统集成

#### 9.3.1 保险核心系统

- **集成内容**：保单数据同步、产品信息获取
- **集成方式**：ESB企业服务总线
- **数据同步**：定时同步+实时通知

#### 9.3.2 体检机构系统

- **集成内容**：体检预约、报告获取
- **集成方式**：API对接
- **数据格式**：JSON/XML

#### 9.3.3 智能设备平台

- **集成内容**：健康数据接入
- **集成方式**：MQTT协议
- **数据类型**：血压、血糖、心率等

---

## 10. 附录

### 10.1 接口清单

详见《企微健康社群方案 - 开发文档》第3章接口设计部分。

### 10.2 数据库设计

详见《企微健康社群方案 - 开发文档》第2章数据库设计部分。

### 10.3 部署架构

详见《企微健康社群方案 - 开发文档》第6章部署方案部分。

### 10.4 变更记录

| 版本 | 日期 | 变更内容 | 变更人 |
|------|------|---------|--------|
| V1.0 | 2026-02-04 | 初始版本 | 产品团队 |

### 10.5 审批记录

| 角色 | 姓名 | 审批意见 | 审批日期 |
|------|------|---------|---------|
| 产品负责人 | | | |
| 技术负责人 | | | |
| 业务负责人 | | | |

---

**文档结束**
